# 测试指南

## 修改内容

### 1. 首页默认对话框
- ✅ 登录后自动创建"默认对话"
- ✅ 如果没有会话，自动创建一个
- ✅ 如果有会话但未选中，自动选中第一个

### 2. 流式响应修复
- ✅ 使用EventSource替代Fetch API
- ✅ 后端支持GET请求（EventSource要求）
- ✅ 正确处理SSE事件：
  - `message` 事件：AI回复内容片段
  - `complete` 事件：回答完成
  - `error` 事件：错误处理

## 测试步骤

### 1. 启动后端
```bash
# 在项目根目录
mvn spring-boot:run
```

### 2. 启动前端
```bash
# 在cooking-chat-web目录
npm run dev
```

### 3. 测试默认对话框

#### 测试场景1：新用户首次登录
1. 注册新用户
2. 登录成功后，应该：
   - ✅ 自动创建"默认对话"
   - ✅ 自动选中该对话
   - ✅ 显示空的对话界面

#### 测试场景2：已有会话的用户
1. 使用已有会话的用户登录
2. 应该：
   - ✅ 显示所有历史会话
   - ✅ 自动选中第一个会话
   - ✅ 加载该会话的历史消息

### 4. 测试流式响应

#### 测试场景1：正常对话
1. 在输入框输入："你好，请介绍一下自己"
2. 按Enter发送
3. 应该看到：
   - ✅ 用户消息立即显示
   - ✅ AI消息逐字显示（流式效果）
   - ✅ 回答完成后停止
   - ✅ 消息保存到数据库

#### 测试场景2：多轮对话
1. 发送第一条消息："什么是React？"
2. 等待回复完成
3. 发送第二条消息："它有什么优点？"
4. 应该看到：
   - ✅ 两条消息都正确显示
   - ✅ 流式响应正常
   - ✅ 消息顺序正确

#### 测试场景3：快速连续发送
1. 快速输入并发送多条消息
2. 应该看到：
   - ✅ 第一条消息处理中时，后续消息被禁用
   - ✅ 等待第一条完成后才能发送下一条

### 5. 测试错误处理

#### 测试场景1：后端未启动
1. 停止后端服务
2. 尝试发送消息
3. 应该看到：
   - ✅ 显示错误提示
   - ✅ 不会卡死

#### 测试场景2：网络中断
1. 发送消息过程中断开网络
2. 应该看到：
   - ✅ 显示连接错误
   - ✅ 可以重试

## 浏览器控制台检查

打开浏览器开发者工具（F12），检查：

### Network标签
- ✅ `/api/chat/stream` 请求类型为 `eventsource`
- ✅ 请求方法为 `GET`
- ✅ URL包含正确的参数：`userId`, `question`, `stream`, `token`
- ✅ 响应类型为 `text/event-stream`

### Console标签
- ✅ 没有JavaScript错误
- ✅ 可以看到"AI回答完成"的日志
- ✅ 没有SSE连接错误

### EventStream查看
在Network标签中点击`/api/chat/stream`请求，查看EventStream标签：
- ✅ 可以看到`message`事件和数据
- ✅ 可以看到`complete`事件
- ✅ 事件按顺序到达

## 预期行为

### 正常流程
1. 用户登录 → 自动创建/选中默认对话
2. 输入消息 → 点击发送
3. 用户消息立即显示
4. AI消息开始流式显示
5. 逐字显示AI回复
6. 完成后保存消息
7. 可以继续对话

### SSE事件流
```
event: message
data: 你

event: message
data: 好

event: message
data: ，

event: message
data: 我

event: message
data: 是

event: complete
data: 回答结束，耗时1234ms
```

## 常见问题

### 1. EventSource连接失败
**症状**：控制台显示"EventSource连接错误"

**检查**：
- 后端是否启动
- URL是否正确
- token是否有效
- 后端是否支持GET请求

### 2. 消息不显示
**症状**：发送消息后没有反应

**检查**：
- 是否选中了会话
- 浏览器控制台是否有错误
- Network标签是否有请求
- 后端日志是否有错误

### 3. 流式效果不明显
**症状**：消息一次性显示，没有逐字效果

**检查**：
- 后端是否真的返回流式数据
- EventSource是否正确监听message事件
- 网络是否太快（本地测试可能很快）

### 4. 默认对话未创建
**症状**：登录后没有自动创建对话

**检查**：
- 浏览器控制台是否有错误
- `/api/conversation/create`请求是否成功
- 后端日志是否有错误
- 数据库是否正常

## 性能检查

### 响应时间
- 登录：< 1s
- 创建会话：< 500ms
- 发送消息：< 100ms
- AI首字响应：< 2s
- 完整回答：取决于内容长度

### 内存使用
- 打开页面：< 50MB
- 对话10轮：< 100MB
- 长时间使用：无明显增长

## 成功标准

- ✅ 登录后自动创建默认对话
- ✅ 消息发送成功
- ✅ AI回复流式显示
- ✅ 消息正确保存
- ✅ 无JavaScript错误
- ✅ 无网络错误
- ✅ 用户体验流畅

## 下一步优化

- [ ] 添加加载动画
- [ ] 优化错误提示
- [ ] 添加重试按钮
- [ ] 显示消息时间
- [ ] 添加消息状态指示器
- [ ] 优化移动端体验
